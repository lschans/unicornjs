var through2=require("through2"),StringDecoder=require("string_decoder").StringDecoder,Stream=require("stream"),commandList=[],commands={};function addCommand(a,b){commands[a]=b;commandList.push(a)}var shellFunctions={exit:function(){console.log("Bye bye");process.exit(0)},clear:function(){return process.stdout.write("\u001bc")}};
function shellIn(a,b,c){a=(new StringDecoder("utf8")).write(a).replace(/^\s+|\s+$/g,"");~commandList.indexOf(a)?this.push(new Buffer(commands[a]()+"\n","utf8")):(console.log("command unknown"),this.push(new Buffer("\n","utf8")));c()}function shellOut(a,b,c){a=(new StringDecoder("utf8")).write(a).replace(/^\s+|\s+$/g,"");"undefined"==a&&(a="");process.stdout.write(new Buffer(a,"utf8"));c()}
function replShell(a,b,c){var d="Welcome to the unicorn shell (v"+a.npm.version+")";addCommand("exit",shellFunctions.exit);addCommand("clear",shellFunctions.clear);return{start:function(){console.log(d);b.start({prompt:"unicorn> ",input:process.stdin.pipe(through2({objectMode:!0,allowHalfOpen:!0},shellIn)),output:(new Stream).pipe(through2({objectMode:!1,allowHalfOpen:!1},shellOut)),terminal:!0,useGlobal:!1,useColors:!0})}}}module.exports=replShell;
